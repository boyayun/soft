<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Kinetis-M Peripheral Bare-Metal Drivers: LPTMR Periodic Wakeup</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://www.mathjax.org/mathjax/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="drivers.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="fsl_logo.gif"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Kinetis-M Peripheral Bare-Metal Drivers
   &#160;<span id="projectnumber">EAR2.2</span>
   </div>
   <div id="projectbrief">Reference Manual</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Introduction</span></a></li>
      <li><a href="pages.html"><span>Pages</span></a></li>
      <li><a href="modules.html"><span>Reference</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__lptmrisr__example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">LPTMR Periodic Wakeup<div class="ingroups"><a class="el" href="group__lptmr__examples.html">LPTMR Examples</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<p>This example demonstrates use of the Low-Power Timer (LPTMR) in energy saving application. The device is placed in either Very Low Power Wait (VLPW) or Very Low Power Stop (VLPS) mode most of the time. It resumes operation when LPTMR interrupt is asserted. The LPTMR is programmed to reset and assert interrupt request when value of counter (CNR) is equal to compare (CMR) and increments. Timer is controlled by internal 1 kHz low power clock and compare (CMR) is set to generate interrupt event every 8 seconds. The power consumption has been measured on a special validation board populated with MKM34Z128CLL5 (Rev 2.0) device: </p>
<table class="doxtable">
<tr>
<th align="center">Power Down Mode </th><th align="center">Idd+Idda+(Ibat=0.0uA)  </th></tr>
<tr>
<td align="center">Very Low Power Run (VLPR) @1.0 MHz (1:1:1)</td><td align="center">177.0uA </td></tr>
<tr>
<td align="center">Very Low Power Wait (VLPW) </td><td align="center">130.0uA </td></tr>
<tr>
<td align="center">Very Low Power Stop (VLPS) </td><td align="center">4.5uA </td></tr>
</table>
<p>Idd+Idda+Ibat measured on a special validation board using METEX M-4650CR Multimeter.*</p>
<dl class="section user"><dt>Source code:</dt><dd><div class="fragment"><div class="line"><span class="comment">/******************************************************************************</span></div>
<div class="line"><span class="comment"> * (c) Copyright 2010-2013, Freescale Semiconductor Inc.</span></div>
<div class="line"><span class="comment"> * ALL RIGHTS RESERVED.</span></div>
<div class="line"><span class="comment"> ******************************************************************************</span></div>
<div class="line"><span class="comment"> * lptmrisr_test.c</span></div>
<div class="line"><span class="comment"> ******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#include &quot;drivers.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/* LPTMR callback function declaration                                        */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> lptmr_callback (<span class="keywordtype">void</span>);</div>
<div class="line"></div>
<div class="line"><span class="comment">/* static data definition                                                     */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <a class="code" href="group__basic__data__types.html#ga2e00abb078d312d1d8c4fbcd6be343d8" title="unsigned 16 bits ">uint16</a> counter;</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> main (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* core, bus and flash clock = 1000 KHz                                     */</span></div>
<div class="line">  <a class="code" href="group__sim__macro.html#ga6e7f0c7c0edd7fc3f093107455303c6d" title="Sets system clock mode [SYSCLKMODE]. ">SIM_SetClkMode</a> (<a class="code" href="group__sim__sysmode.html#gadec75cdc4e708f57d985a98895301efc" title="1:1:1; System : Bus : Flash clock ratio ">SYSCLK_MODE0</a>);</div>
<div class="line">  <a class="code" href="group__sim__macro.html#gac9736d86362b16880c372125db55b28a" title="Sets system clock divider mode. ">SIM_SetClkDiv</a>  (<a class="code" href="group__sim__sysdiv.html#gab927c3c32a8ba78fbc2774d8cd838c71" title="divide by 02 ">SYSCLK_DIV2</a>);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* enable clock to LPTMR on-chip peripheral                                 */</span></div>
<div class="line">  <a class="code" href="group__sim__macro.html#gadd8409f360d84e3d1af532b689d2479d" title="Enables clock to selected on-chip module. ">SIM_EnableModule</a> (LPTMR);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* enable low voltage reset detection (1.6V), disable interrupts and bandgap*/</span> </div>
<div class="line">  <a class="code" href="group__pmc__macro.html#ga3a932d9fb1aeba3773a187245a59d19f" title="PMC initialization. ">PMC_Init</a> (<a class="code" href="group__pmc__module__config.html#gae2bb490dbe7498cbade849f47ef82fc2">PMC_MODULE_LVDRE_ON_LVDINT_OFF_LVWINT_OFF_CONFIG</a>(<a class="code" href="group__pmc__lvdv.html#gadfe7a27e8358c40e4150e1c9f5492d91" title="Falling low-voltage detect low range (1.6 V). ">PMC_LVDL</a>,<a class="code" href="group__pmc__lvwv.html#ga0ac87b21aedcbe39e6c4d105cf1ac22e" title="Low trip point is 2.7 V if PMC_LVDH (low-voltage detect high range) selected otherwise it is 1...">PMC_LVW1</a>),</div>
<div class="line">            <a class="code" href="group__pmc__intreg__config.html#gaa8570239f9dd7549ed960a6cda5e8ef3">PMC_INTREG_BGEN_OFF_BGBE_OFF_CONFIG</a>, <a class="code" href="group__cm0plus__prilvl.html#ga3461048206d4aa48866deedbdd269c1b" title="Priority level 0 (highest priority) ">PRI_LVL0</a>, (<a class="code" href="group__pmc__callback.html#gad015859e7ae5154e4172ba5857d50b50" title="PMC_CALLBACK function declaration. ">PMC_CALLBACK</a>)NULL);</div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* enable transitions for VLPR and VLPS mode                                */</span></div>
<div class="line">  <a class="code" href="group__smc__macro.html#gaec829fb4ccda92c5271cb4d6bb210395" title="SMC initialization. ">SMC_Init</a> (<a class="code" href="group__smc__config.html#gae2d757fe0a137d096da5d44a280caf23" title="Only Very-Low-Power (VLPS) modes enabled. ">SMC_MODULE_VLPS_ON_VLLS_OFF_CONFIG</a>); </div>
<div class="line">  <a class="code" href="group__osc32k__macro.html#ga4686d35e2225c426b4c7a3038aeb5868" title="Disable RTC 32KHz oscillator. ">OSC32K_Disable</a> ();      <span class="comment">/* disable OSC32K oscillator                        */</span></div>
<div class="line">  <a class="code" href="group__smc__macro.html#gabbc72e0b58d6236338fe1e11eebefce0" title="Sets device operating mode. ">SMC_SetMode</a>(VLPR);      <span class="comment">/* enter VLPR mode to minimize current consumption  */</span></div>
<div class="line">  </div>
<div class="line">  <span class="comment">/* initialize LPTMR in counter reset mode                                   */</span>  </div>
<div class="line">  <a class="code" href="group__lptmr__macro.html#ga63b65401607d625bde32b8c7a2984bd2" title="LPTMR initialization. ">LPTMR_Init</a>(<a class="code" href="group__lptmr__config.html#ga66b34237178700b625fe1760deac9b3d" title="Timer mode selected and Timer operation is disabled after LPTMR_Init() function call. Timer counts until TCF flag is set then counter is reset and counting starts again. ">LPTMR_MODULE_TIMER_CNT_RST_ONTCF_MODE_CONFIG</a>(0,<a class="code" href="group__lptmr__clocks.html#gac260f3c8edbb573855b75f8c6f117e9e" title="Internal 1 KHz LPO clock. ">LPTMR_LPOCLK</a>),3999); </div>
<div class="line">  <a class="code" href="group__lptmr__macro.html#gad3e1dcc8dcea6f4e552aadcb84be29e8" title="Installs callback function for LPTMR interrupt vector 46. ">LPTMR_InstallCallback</a> (<a class="code" href="group__cm0plus__prilvl.html#gab04f6dcc0fae0bd8c5af1bb66eb9c035" title="Priority level 1. ">PRI_LVL1</a>, lptmr_callback);</div>
<div class="line">  <a class="code" href="group__cm0plus__macros.html#gab1eea217dc48da9434887d1b9eca9067" title="Enables all interrupts. ">EnableInterrupts</a>();     <span class="comment">/* enable interrupts on global level                */</span>  </div>
<div class="line">  <a class="code" href="group__lptmr__macro.html#ga642f2e40df5deba39d1f80df75005ac0" title="Resumes Timer operation. ">LPTMR_Enable</a>();         <span class="comment">/* enable LPTMR (8000ms interrupt)                  */</span></div>
<div class="line">  </div>
<div class="line">  <span class="keywordflow">while</span> (1)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="group__smc__macro.html#gabbc72e0b58d6236338fe1e11eebefce0" title="Sets device operating mode. ">SMC_SetMode</a>(VLPW);    <span class="comment">/* keep staying in VLPW mode; IDD+IDDA+IBAT=130.0uA */</span></div>
<div class="line">    <a class="code" href="group__smc__macro.html#gabbc72e0b58d6236338fe1e11eebefce0" title="Sets device operating mode. ">SMC_SetMode</a>(VLPS);    <span class="comment">/* keep staying in VLPS mode; IDD+IDDA+IBAT=4.5uA   */</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* LPTMR interrupt - called every 8000 ms                                     */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> lptmr_callback (<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    counter++;            <span class="comment">/* increment variable; IDD+IDDA+IBAT=177uA          */</span></div>
<div class="line">    <a class="code" href="group__cm0plus__macros.html#ga0b5ca6aa7c63e6a510cec72bb3f3f665" title="Function delays software execution by number of core clock cycles. ">arch_delay</a>(4000000);  <span class="comment">/* wait for 4000 ms                                 */</span></div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Appconfig.h:</dt><dd><div class="fragment"><div class="line"><span class="comment">/*****************************************************************************</span></div>
<div class="line"><span class="comment"> * (c) Copyright 2010, Freescale Semiconductor Inc.</span></div>
<div class="line"><span class="comment"> * ALL RIGHTS RESERVED.</span></div>
<div class="line"><span class="comment"> ***************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#ifndef __APPCONFIG_H</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define __APPCONFIG_H</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/***************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#define MCU_MKM34Z50</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/***************************************************************************/</span></div>
<div class="line"><span class="comment">//#define MTB_RAM_RESERVE</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/***************************************************************************/</span></div>
<div class="line"><span class="comment">//#define EMULATE_BME_IO_ACCESS</span></div>
<div class="line"></div>
<div class="line"><span class="comment">/***************************************************************************/</span></div>
<div class="line"><span class="comment">/***************************************************************************/</span></div>
<div class="line"><span class="comment">/***************************************************************************/</span></div>
<div class="line"><span class="keyword">extern</span> <span class="keywordtype">void</span> lptmr_isr (<span class="keywordtype">void</span>);</div>
<div class="line"><span class="preprocessor">#define VECTOR_046 lptmr_isr </span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="comment">/******************************************************************************/</span></div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* __APPCONFIG_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>Toolchain support:</dt><dd><table class="doxtable">
<tr>
<th align="center">IAR EWARM 6.5x</th><th align="center">CW MCU 10.x</th><th align="center">KEIL uVision 4.72</th><th align="center">CrossWorks 2.3.3  </th></tr>
<tr>
<td align="center">x </td><td align="center">x </td><td align="center"></td><td align="center">x </td></tr>
</table>
</dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Nov 4 2013 13:45:06 for Kinetis-M Peripheral Bare-Metal Drivers by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
